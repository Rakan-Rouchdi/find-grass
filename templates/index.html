<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Grass Detector</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-top: 1rem;
      color: #006400;
    }
    #video {
      width: 100%;
      max-width: 600px;
      border: 2px solid #ccc;
      border-radius: 4px;
    }
    #canvas {
      display: none;
    }
    #controls {
      margin-top: 1rem;
    }
    button {
      padding: 0.5rem 1rem;
      margin: 0 0.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #startButton {
      background-color: #28a745;
      color: white;
    }
    #captureButton {
      background-color: #007bff;
      color: white;
    }
    #result-message {
      margin-top: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Grass Detector</h1>
  <!-- Video element to display the camera feed -->
  <video id="video" autoplay playsinline></video>
  <!-- Hidden canvas used to capture frames for analysis -->
  <canvas id="canvas"></canvas>
  <div id="controls">
    <!-- Button to request access to the camera and start streaming -->
    <button id="startButton">Start Camera</button>
    <!-- Button to capture a frame and perform grass detection -->
    <button id="captureButton" hidden>Capture</button>
  </div>
  <!-- Message area for success/failure feedback -->
  <div id="result-message"></div>

  <script>
    // Grab references to DOM elements
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const startButton = document.getElementById('startButton');
    const captureButton = document.getElementById('captureButton');
    const resultMessage = document.getElementById('result-message');

    let streaming = false;

    // Request access to the camera when the Start button is clicked
    startButton.addEventListener('click', async () => {
      try {
        // The MediaDevices.getUserMedia() API prompts the user for permission
        // and returns a stream if allowed【594760590154827†L275-L283】. We request video only.
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        await video.play();
        streaming = true;
        // Hide the Start button and show the Capture button
        startButton.hidden = true;
        captureButton.hidden = false;
      } catch (err) {
        console.error('Error accessing camera:', err);
        alert('Unable to access camera. Please allow camera access and try again.');
      }
    });

    // Capture a frame from the video and analyse it for green pixels
    captureButton.addEventListener('click', () => {
      if (!streaming) return;
      const width = video.videoWidth;
      const height = video.videoHeight;
      // Set canvas dimensions to the same size as the video frame
      canvas.width = width;
      canvas.height = height;
      const context = canvas.getContext('2d');
      // Draw the current video frame onto the canvas【594760590154827†L346-L359】
      context.drawImage(video, 0, 0, width, height);
      // Retrieve pixel data from the canvas
      const imageData = context.getImageData(0, 0, width, height);
      const data = imageData.data;
      let greenPixels = 0;
      const totalPixels = width * height;
      // Loop through pixels in RGBA order
      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        // A simple green detection heuristic: the green channel must dominate
        // red and blue by a margin and be bright enough. This is inspired by
        // colour thresholding techniques that extract specific colours by
        // defining a range【479374847350895†L53-L59】.
        if (g > 60 && g > 1.3 * r && g > 1.3 * b) {
          greenPixels++;
        }
      }
      const greenRatio = greenPixels / totalPixels;
      // If a sufficient percentage of pixels are green, we assume grass
      if (greenRatio > 0.05) {
        resultMessage.textContent = 'Congratulations! You touched grass! \uD83C\uDF3F';
        resultMessage.style.color = '#28a745';
      } else {
        const jokes = [
          'This is not grass. Maybe try going outside?',
          'Nice try, but that’s not grass! \uD83E\uDD14',
          'No green here! Step outside for some fresh grass.',
          'Oops! That doesn’t look like grass. Touch some real grass!'
        ];
        resultMessage.textContent = jokes[Math.floor(Math.random() * jokes.length)];
        resultMessage.style.color = '#dc3545';
      }
    });
  </script>
</body>
</html>
